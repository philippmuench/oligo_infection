{
    "collab_server" : "",
    "contents" : "#' produce heatmaps for each Category with subcat informations\n\nrm(list = ls())\n\nrequire(ggplot2)\nrequire(RColorBrewer)\nrequire(reshape2)\nlibrary(pander)\n\nI46_orig <- read.csv2(\"data/I46_features.tsv.tsv\", sep=\"\\t\", header=T)\nI48_orig <- read.csv2(\"data/I48_features.tsv.tsv\", sep=\"\\t\", header=T)\nI49_orig <- read.csv2(\"data/I49_features.tsv.tsv\", sep=\"\\t\", header=T)\nKB18_orig <- read.csv2(\"data/KB18_DSMZ_features.tsv.tsv\", sep=\"\\t\", header=T)\nKB1_orig <- read.csv2(\"data/KB1_features.tsv.tsv\", sep=\"\\t\", header=T)\nYL27_orig <- read.csv2(\"data/YL27_features.tsv.tsv\", sep=\"\\t\", header=T)\nYL2_orig <- read.csv2(\"data/YL2_features.tsv.tsv\", sep=\"\\t\", header=T)\nYL31_orig <- read.csv2(\"data/YL31_features.tsv.tsv\", sep=\"\\t\", header=T)\nYL32_orig <- read.csv2(\"data/YL32_features.tsv.tsv\", sep=\"\\t\", header=T)\nYL44_orig <- read.csv2(\"data/YL44_features.tsv.tsv\", sep=\"\\t\", header=T)\nYL45_orig <- read.csv2(\"data/YL45_features.tsv.tsv\", sep=\"\\t\", header=T)\nYL58_orig <- read.csv2(\"data/YL58_features.tsv.tsv\", sep=\"\\t\", header=T)\n\npval_mat <- data.frame(cat=unique(YL58_orig$Category), pval = 1)\n\nfor (cat in (unique(YL58_orig$Category))){\n  if (cat == \"Iron acquisition and metabolism\"){\n    next\n  }\n  \n  if (cat == \"Secondary Metabolism\"){\n    next\n  }\n  \n  if (cat == \"Motility and Chemotaxis\"){\n    next\n  }\n  \n  print(cat)\n  #cat <- \"Amino Acids and Derivatives\"\n  I46 <- I46_orig[which(I46_orig$Category==cat),]\n  I48 <- I48_orig[which(I48_orig$Category==cat),]\n  I49 <- I49_orig[which(I49_orig$Category==cat),]\n  KB1 <- KB1_orig[which(KB1_orig$Category==cat),]\n  YL27 <- YL27_orig[which(YL27_orig$Category==cat),]\n  YL2 <- YL2_orig[which(YL2_orig$Category==cat),]\n  YL31 <- YL31_orig[which(YL31_orig$Category==cat),]\n  YL32 <- YL32_orig[which(YL32_orig$Category==cat),]\n  YL44 <- YL44_orig[which(YL44_orig$Category==cat),]\n  YL45 <- YL45_orig[which(YL45_orig$Category==cat),]\n  YL58 <- YL58_orig[which(YL58_orig$Category==cat),]\n  \n  I46_out <- I46_orig[which(I46_orig$Category!=cat),]\n  I48_out <- I48_orig[which(I48_orig$Category!=cat),]\n  I49_out <- I49_orig[which(I49_orig$Category!=cat),]\n  KB1_out <- KB1_orig[which(KB1_orig$Category!=cat),]\n  YL27_out <- YL27_orig[which(YL27_orig$Category!=cat),]\n  YL2_out <- YL2_orig[which(YL2_orig$Category!=cat),]\n  YL31_out <- YL31_orig[which(YL31_orig$Category!=cat),]\n  YL32_out <- YL32_orig[which(YL32_orig$Category!=cat),]\n  YL44_out <- YL44_orig[which(YL44_orig$Category!=cat),]\n  YL45_out <- YL45_orig[which(YL45_orig$Category!=cat),]\n  YL58_out <- YL58_orig[which(YL58_orig$Category!=cat),]\n  \n  I46$sample <- \"I46\"\n  I48$sample <- \"I48\"\n  I49$sample <- \"I49\"\n  KB1$sample <- \"KB1\"\n  YL27$sample <- \"YL27\"\n  YL31$sample <- \"YL31\"\n  YL32$sample <- \"YL32\"\n  YL44$sample <- \"YL44\"\n  YL45$sample <- \"YL45\"\n  YL58$sample <- \"YL58\"\n  \n  YL27_t_out <- sum(as.data.frame(table(YL27_out$Subcategory))$Freq)\n  YL45_t_out <- sum(as.data.frame(table(YL45_out$Subcategory))$Freq)\n  YL44_t_out <- sum(as.data.frame(table(YL44_out$Subcategory))$Freq)\n  YL32_t_out <- sum(as.data.frame(table(YL32_out$Subcategory))$Freq)\n  I48_t_out <- sum(as.data.frame(table(I48_out$Subcategory))$Freq)\n  YL58_t_out <- sum(as.data.frame(table(YL58_out$Subcategory))$Freq)\n  YL31_t_out <- sum(as.data.frame(table(YL31_out$Subcategory))$Freq)\n  I46_t_out <- sum(as.data.frame(table(I46_out$Subcategory))$Freq)\n  I49_t_out <- sum(as.data.frame(table(I49_out$Subcategory))$Freq)\n  KB1_t_out <- sum(as.data.frame(table(KB1_out$Subcategory))$Freq)\n  \n  YL27_t <- sum(as.data.frame(table(YL27$Subcategory))$Freq)\n  YL45_t <- sum(as.data.frame(table(YL45$Subcategory))$Freq)\n  YL44_t <- sum(as.data.frame(table(YL44$Subcategory))$Freq)\n  YL32_t <- sum(as.data.frame(table(YL32$Subcategory))$Freq)\n  I48_t <- sum(as.data.frame(table(I48$Subcategory))$Freq)\n  YL58_t <- sum(as.data.frame(table(YL58$Subcategory))$Freq)\n  YL31_t <- sum(as.data.frame(table(YL31$Subcategory))$Freq)\n  I46_t <- sum(as.data.frame(table(I46$Subcategory))$Freq)\n  I49_t <- sum(as.data.frame(table(I49$Subcategory))$Freq)\n  KB1_t <- sum(as.data.frame(table(KB1$Subcategory))$Freq)\n  \n  YL27_t2 <- as.data.frame(table(YL27$Subcategory))\n  YL45_t2 <- as.data.frame(table(YL45$Subcategory))\n  YL44_t2 <- as.data.frame(table(YL44$Subcategory))\n  YL32_t2 <- as.data.frame(table(YL32$Subcategory))\n  I48_t2 <- as.data.frame(table(I48$Subcategory))\n  YL58_t2 <- as.data.frame(table(YL58$Subcategory))\n  YL31_t2 <- as.data.frame(table(YL31$Subcategory))\n  I46_t2 <- as.data.frame(table(I46$Subcategory))\n  I49_t2 <- as.data.frame(table(I49$Subcategory))\n  KB1_t2 <- as.data.frame(table(KB1$Subcategory))\n  \n  \n  depleted_case <- sum(YL27_t, YL45_t, YL44_t, YL32_t,I48_t )\n  depleted_control <- sum(YL27_t_out, YL45_t_out, YL44_t_out, YL32_t_out, I48_t_out )\n  \n  intermediate_case <- sum(YL58_t, YL31_t, I46_t)\n  intermediate_control <- sum(YL58_t_out, YL31_t_out, I46_t_out)\n  \n  enriched_case <- sum(I49_t, KB1_t )\n  enriched_control <- sum(I49_t_out, KB1_t_out)\n  \n  mat <- matrix(c(depleted_case, intermediate_case, enriched_case,\n                  depleted_control, intermediate_control, enriched_control), nrow=2, ncol=3, byrow=TRUE)\n  \n  test <- fisher.test(mat, simulate.p.value=TRUE,B=1e7)\n  \n  pval_mat[which(pval_mat$cat == cat),]$pval <- test$p.value\n  \n  # get sum of missing/complete\n  #depleted.table <- sum(YL27_t$Freq) + sum(YL45_t$Freq) + sum(YL44_t$Freq)+ sum(YL32_t$Freq)+ sum(I48_t$Freq)\n  #intermediate.table <- sum(YL58_t$Freq) + sum(YL31_t$Freq) + sum(I46_t$Freq)\n  #enriched.table <- sum(I49_t$Freq) + sum(KB1_t$Freq)\n  #mat <- rbind(depleted.table, intermediate.table, enriched.table)\n  #chisq.test(mat) \n  \n  I46_t2$sample <- \"c_I46\"\n  I48_t2$sample <- \"f_I48\"\n  I49_t2$sample <- \"b_I49\"\n  KB1_t2$sample <- \"a_KB1\"\n  YL27_t2$sample <- \"j_YL27\"\n  YL31_t2$sample <- \"d_YL31\"\n  YL32_t2$sample <- \"g_YL32\"\n  YL44_t2$sample <- \"h_YL44\"\n  YL45_t2$sample <- \"i_YL45\"\n  YL58_t2$sample <- \"e_YL58\"\n  \n  df_count <- as.data.frame(rbind(YL27_t2, YL45_t2, YL44_t2, YL32_t2, I48_t2, YL58_t2, YL31_t2,\n                                  I46_t2, I49_t2, KB1_t2))\n  df_count <- df_count[which(df_count$Freq > 0),]\n  \n  df <- dcast(data = df_count,formula = sample~ Var1,fun.aggregate = sum,value.var = \"Freq\")\n  samples <- df$sample\n  df$sample <- NULL \n  \n  d <- melt(df_count)\n  d$z_bin <- cut(d$value, breaks = c(1, 20, 40, 60, 80, 100, 120,140,160, 180))\n  base_size <- 10\n  \n  p <- ggplot(d, aes(sample, reorder(Var1, value)) )\n  p <- p + geom_tile(aes(fill = z_bin)) + coord_equal()\n  p <- p + ggtitle(paste0(cat, \" (\",test$p.value,\")\"))\n  p <- p +  theme(axis.text.y   = element_text(size=14),\n                  axis.text.x   = element_text(size=14),\n                  axis.title.y  = element_text(size=14),\n                  axis.title.x  = element_text(size=14),\n                  panel.background = element_blank(),\n                  panel.grid.major = element_blank(), \n                  panel.grid.minor = element_blank(),\n                  axis.line = element_line(colour = \"black\"),\n                  panel.border = element_rect(colour = \"black\", fill=NA, size=1.2)\n  )\n  \n  p <- p + theme_minimal(base_size = base_size) + scale_fill_brewer(palette = \"YlGnBu\", direction = 1)\n  \n  pdf(paste0(\"analysis1/heatmap_category_\", cat,\".pdf\"))\n  print(p)\n  dev.off()\n}\n\npval_mat$fdr <- NULL\npval_mat$fdr <- p.adjust(pval_mat$pval, method=\"fdr\")\npval_mat$stars <- add.significance.stars(pval_mat$fdr)\n\nwrite.table(pval_mat, file=\"analysis1/pval_category.txt\", sep='\\t', row.names = F, quote = F)",
    "created" : 1500981909997.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3147155126",
    "id" : "2CA29597",
    "lastKnownWriteTime" : 1500982999,
    "last_content_update" : 1500982999111,
    "path" : "~/github.com/philippmuench/oligo_infection/analysis1.R",
    "project_path" : "analysis1.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}